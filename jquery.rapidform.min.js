(function(a){a.fn.rapidForm=function(c){var h=a(this),f,g,e,b,d;g={submit:".submit",submitContinue:".continue",remove:".remove",cancel:".cancel",formGroup:".form-group",helpBlock:".help-block",formGroupClass:"has-error",helpBlockContent:'<i class="fa fa-warning"></i> {message}',alert:"#alert",alertSuccess:'<div class="alert alert-success fade in"><button type="button" class="close" data-dismiss="alert"><i class="fa fa-times"></i></button><i class="fa-fw fa fa-check"></i><strong>Success!</strong> {message}</div>',alertError:'<div class="alert alert-danger fade in"><button type="button" class="close" data-dismiss="alert"><i class="fa fa-times"></i></button><i class="fa-fw fa fa-warning"></i><strong>Error!</strong> {message}</div>',confirmRemove:"Are you sure?",beforeRemove:function(){var j=new a.Deferred;(!e.confirmRemove||confirm(e.confirmRemove))?j.resolve():j.reject();return j.promise()},confirmSubmit:null,beforeSubmit:function(){var j=new a.Deferred;(!e.confirmSubmit||confirm(e.confirmSubmit))?j.resolve():j.reject();return j.promise()},afterSubmit:null,dialog:null,urlAdd:null,titleAdd:"Create",titleEdit:"Edit",width:"80%",template:"#template",container:"#tbody",row:"tr:visible",insertAfter:null,insertBefore:null,open:null,heightTextare:true};e=a.extend({},g,c);b=function(l,q,p,n){var k,o,r,j;if(!n){n=l}for(k in q){o=(k)?n.find(k):n;r=(k)?l.find(k):n;if(o.length){attrs=q[k].split(/ *, */);for(i=0;i<attrs.length;i++){j=attrs[i];switch(j){case"text":o.each(function(s){var u=a(this),t;if(str=u.text()){if(m=str.match(/\{(.+)\}/)){key=m[1];if(p[key]!=null){t=RegExp("{"+key+"}");str=str.replace(t,p[key]);r.eq(s).text(str)}}}});break;case"data-raw":str=JSON.stringify(p);r.get(0).setAttribute("data-raw",str);break;default:r.each(function(s){var u=a(this),t;if(str=u.attr(j)){if(m=str.match(/\{(.+)\}/)){key=m[1];if(p[key]!=null){t=RegExp("{"+key+"}");str=str.replace(t,p[key]);r.eq(s).attr(j,str)}}}});break}}}}};h.each(function(){var j=a(this);j.find(e.submit+","+e.submitContinue).filter(":button").click(function(){var k=a(this);e.beforeSubmit(j).done(function(){j.find(e.helpBlock).text("").hide();j.find(e.formGroup).removeClass(e.formGroupClass);a.ajax({url:j.attr("action"),data:new FormData(j[0]),contentType:false,processData:false,type:"post",dataType:"json"}).done(function(q){var p,o,t,n,s,r,l;if(q&&q.errors){for(p in q.errors){o=j.find('[name="'+p+'"],[for="'+p+'"]').parents(e.formGroup);t=o.find(e.helpBlock);o.addClass(e.formGroupClass);t.show().html(e.helpBlockContent.replace(/\{message\}/,q.errors[p]))}return}if(e.afterSubmit){e.afterSubmit(j,q)}if(q&&q.reload){location.reload();return}if(q&&q.redirect){location.href=q.redirect;return}if(e.dialog&&j.parents(e.dialog).length&&k.is(e.submit)){a(e.dialog).dialog("close")}else{if(q&&q.form=="clear"||k.is(e.submitContinue)){j.find("input:not(:checkbox,:radio), textarea").val("")}}if(q&&q.alertSuccess){a(e.alert).html(e.alertSuccess.replace(/\{message\}/,q.alertSuccess))}if(q&&q.alertError){a(e.alert).html(e.alertError.replace(/\{message\}/,q.alertSuccess))}if(q&&q.raw){n=a(e.template).clone().show();s=n.data("template");n.removeAttr("id data-template");if(f){$current=f.parents(e.row+":first");b($current,s,q.raw,n)}else{b(n,s,q.raw);r=a(e.container);l=null;if(e.insertAfter){index=e.insertAfter(r,q.raw);if(index!=null){l=r.find(e.row).eq(index);n.insertAfter(l)}}else{if(e.insertBefore){index=e.insertBefore(r,q.raw);if(index!=null){l=r.find(e.row).eq(index);n.insertBefore(l)}}}if(!l){n.appendTo(r)}}}})})});j.find(e.remove).click(function(){e.beforeRemove(j).done(function(){j.find(e.helpBlock).text("").hide();j.find(e.formGroup).removeClass(e.formGroupClass);a.ajax({url:j.attr("action").replace(/\/edit$/,"/remove"),type:"get",dataType:"json"}).done(function(n){var l,k,o;if(n&&n.errors){for(l in n.errors){k=j.find('[name="'+l+'"],[for="'+l+'"]').parents(e.formGroup);o=k.find(e.helpBlock);k.addClass(e.formGroupClass);o.show().html(e.helpBlockContent.replace(/\{message\}/,n.errors[l]))}return}if(n){if(n.reload){location.reload();return}if(n.redirect){location.href=n.redirect;return}}if(e.dialog&&j.parents(e.dialog).length){a(e.dialog).dialog("close")}if(f){f.parents(e.row+":first").remove()}})})});if(j.find(":submit").length==0&&j.find(".btn-primary:button").length>0){j.find("input,textarea").keypress(function(k){var l=a(k.currentTarget),n=k.charCode||k.keyCode;if(n==13){if(l.is("textarea")){return}if(l.is(":not(:checkbox,:radio)")){j.find(".btn-primary:button").eq(0).click()}return false}})}});d=function(l,o,k,p){var n=a(l),j=n.find("form");if(k){j.attr("action",k)}else{if(k=j.data("action")){j.attr("action",k)}}if(!n.find(e.helpBlock).text().length){n.find("input, textarea, select").each(function(){var s=a(this),r=s.attr("name"),t=s.attr("type"),q,u;if(t=="radio"||t=="checkbox"){if(p){s.prop("checked",(s.val()==p[r]))}}else{if(p){s.val(str=p[r]);if(e.heightTextare&&s.is("textarea")&&str.length){q=str.match(/\n/);u=(q)?q.length+1:1;s.css("height",(u*3)+"em")}}else{s.val("")}}})}if(p){$remove=n.find(e.remove).show();if($remove.is("a")&&k){$remove.attr("href",k.replace(/\/edit$/,"/remove")).show()}n.find(".add-disabled").prop("disabled",false);n.find(".edit-disabled").prop("disabled",true);n.find(".add-hide").show();n.find(".edit-hide").hide()}else{n.find(".remove").hide();n.find(".add-disabled").prop("disabled",true);n.find(".edit-disabled").prop("disabled",false);n.find(".add-hide").hide();n.find(".edit-hide").show()}n.dialog({title:o,width:e.width,modal:true,open:e.open,close:function(){n.find(e.helpBlock).text("").hide();n.find(e.formGroup).removeClass(e.formGroupClass)}});n.find(e.cancel).filter(":button").unbind("click").click(function(){n.dialog("close")})};a.fn.rapidForm.clickAdd=function(j){f=null;if(!j){j=e.titleAdd}d(e.dialog,j,e.urlAdd)};a.fn.rapidForm.clickEdit=function(k,l){f=k;if(!l){l=e.titleEdit}var j,n;j=f.data("action");if(!j){j=f.attr("href")}n=a.parseJSON(f.attr("data-raw"));d(e.dialog,l,j,n)};a.fn.rapidForm.clickCustom=function(k,l,j){f=null;d(k,l,j)};a(e.helpBlock+":visible").parents(e.formGroup).addClass(e.formGroupClass);return h}})(jQuery);