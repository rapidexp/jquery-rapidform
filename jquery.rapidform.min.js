(function(b){var a;b.fn.rapidForm=function(d){var h=b(this),g,f,c,e;g={submit:".submit",submitContinue:".continue",remove:".remove",cancel:".cancel",formGroup:".form-group",helpBlock:".help-block",formGroupClass:"has-error",helpBlockContent:'<i class="fa fa-warning"></i> {message}',alert:"#alert",alertSuccess:'<div class="alert alert-success fade in"><button type="button" class="close" data-dismiss="alert"><i class="fa fa-times"></i></button><i class="fa-fw fa fa-check"></i><strong>Success!</strong> {message}</div>',alertError:'<div class="alert alert-danger fade in"><button type="button" class="close" data-dismiss="alert"><i class="fa fa-times"></i></button><i class="fa-fw fa fa-warning"></i><strong>Error!</strong> {message}</div>',confirmRemove:"Are you sure?",beforeRemove:function(){var j=new b.Deferred;(!f.confirmRemove||confirm(f.confirmRemove))?j.resolve():j.reject();return j.promise()},confirmSubmit:null,beforeSubmit:function(){var j=new b.Deferred;(!f.confirmSubmit||confirm(f.confirmSubmit))?j.resolve():j.reject();return j.promise()},afterSubmit:null,dialog:null,urlAdd:null,titleAdd:"Create",titleEdit:"Edit",width:"80%",template:"#template",container:"#tbody",row:"tr:visible",insertAfter:null,insertBefore:null,open:null,heightTextare:true};f=b.extend({},g,d);c=function(l,q,p,n){var k,o,r,j;if(!n){n=l}for(k in q){o=(k)?n.find(k):n;r=(k)?l.find(k):n;if(o.length){attrs=q[k].split(/[ ,]+/);for(i=0;i<attrs.length;i++){j=attrs[i];switch(j){case"text":o.each(function(s){var u=b(this),t;if(str=u.text()){if(m=str.match(/\{(.+)\}/)){key=m[1];if(p[key]!=null){t=RegExp("{"+key+"}");str=str.replace(t,p[key]);r.eq(s).text(str)}}}});break;case"data-raw":str=JSON.stringify(p);r.get(0).setAttribute("data-raw",str);break;default:r.each(function(s){var u=b(this),t;if(str=u.attr(j)){if(m=str.match(/\{(.+)\}/)){key=m[1];if(p[key]!=null){t=RegExp("{"+key+"}");str=str.replace(t,p[key]);r.eq(s).attr(j,str)}}}});break}}}}};h.each(function(){var j=b(this);j.find(f.submit+","+f.submitContinue).filter(":button").click(function(){var k=b(this);f.beforeSubmit(j).done(function(){j.find(f.helpBlock).text("").hide();j.find(f.formGroup).removeClass(f.formGroupClass);b.ajax({url:j.attr("action"),data:new FormData(j[0]),contentType:false,processData:false,type:"post",dataType:"json"}).done(function(q){var p,o,t,n,s,r,l;if(q&&q.errors){for(p in q.errors){o=j.find('[name="'+p+'"],[for="'+p+'"]').parents(f.formGroup);t=o.find(f.helpBlock);o.addClass(f.formGroupClass);t.show().html(f.helpBlockContent.replace(/\{message\}/,q.errors[p]))}return}if(f.afterSubmit){f.afterSubmit(j,q)}if(q&&q.reload){location.reload();return}if(q&&q.redirect){location.href=q.redirect;return}if(f.dialog&&j.parents(f.dialog).length&&k.is(f.submit)){b(f.dialog).dialog("close")}else{if(q&&q.form=="clear"||k.is(f.submitContinue)){j.find("input:not(:checkbox,:radio), textarea").val("")}}if(q&&q.alertSuccess){b(f.alert).html(f.alertSuccess.replace(/\{message\}/,q.alertSuccess))}if(q&&q.alertError){b(f.alert).html(f.alertError.replace(/\{message\}/,q.alertSuccess))}if(q&&q.raw){n=b(f.template).clone().show();s=n.data("template");n.removeAttr("id data-template");if(a){$current=a.parents(f.row+":first");c($current,s,q.raw,n)}else{c(n,s,q.raw);r=b(f.container);l=null;if(f.insertAfter){index=f.insertAfter(r,q.raw);if(index!=null){l=r.find(f.row).eq(index);n.insertAfter(l)}}else{if(f.insertBefore){index=f.insertBefore(r,q.raw);if(index!=null){l=r.find(f.row).eq(index);n.insertBefore(l)}}}if(!l){n.appendTo(r)}}}})})});j.find(f.remove).click(function(){f.beforeRemove(j).done(function(){j.find(f.helpBlock).text("").hide();j.find(f.formGroup).removeClass(f.formGroupClass);b.ajax({url:j.attr("action").replace(/\/edit$/,"/remove"),type:"get",dataType:"json"}).done(function(n){var l,k,o;if(n&&n.errors){for(l in n.errors){k=j.find('[name="'+l+'"],[for="'+l+'"]').parents(f.formGroup);o=k.find(f.helpBlock);k.addClass(f.formGroupClass);o.show().html(f.helpBlockContent.replace(/\{message\}/,n.errors[l]))}return}if(n){if(n.reload){location.reload();return}if(n.redirect){location.href=n.redirect;return}}if(f.dialog&&j.parents(f.dialog).length){b(f.dialog).dialog("close")}if(a){a.parents(f.row+":first").remove()}})})});if(j.find(":submit").length==0&&j.find(".btn-primary:button").length>0){j.find("input,textarea").keypress(function(k){var l=b(k.currentTarget),n=k.charCode||k.keyCode;if(n==13){if(l.is("textarea")){return}if(l.is(":not(:checkbox,:radio)")){j.find(".btn-primary:button").eq(0).click()}return false}})}});e=function(l,o,k,p){var n=b(l),j=n.find("form");if(k){j.attr("action",k)}else{if(k=j.data("action")){j.attr("action",k)}}if(!n.find(f.helpBlock).text().length){n.find("input, textarea, select").each(function(){var s=b(this),r=s.attr("name"),t=s.attr("type"),q,u;if(t=="radio"||t=="checkbox"){if(p){s.prop("checked",(s.val()==p[r]))}}else{if(p){s.val(str=p[r]);if(f.heightTextare&&s.is("textarea")&&str.length){q=str.match(/\n/);u=(q)?q.length+1:1;s.css("height",(u*3)+"em")}}else{s.val("")}}})}if(p){$remove=n.find(f.remove).show();if($remove.is("a")&&k){$remove.attr("href",k.replace(/\/edit$/,"/remove")).show()}n.find(".add-disabled").prop("disabled",false);n.find(".edit-disabled").prop("disabled",true);n.find(".add-hide").show();n.find(".edit-hide").hide()}else{n.find(".remove").hide();n.find(".add-disabled").prop("disabled",true);n.find(".edit-disabled").prop("disabled",false);n.find(".add-hide").hide();n.find(".edit-hide").show()}n.dialog({title:o,width:f.width,modal:true,open:f.open,close:function(){n.find(f.helpBlock).text("").hide();n.find(f.formGroup).removeClass(f.formGroupClass)}});n.find(f.cancel).filter(":button").unbind("click").click(function(){n.dialog("close")})};b.fn.rapidForm.open=function(k,l){a=l;f=b.extend({},g,k);var j,o,n=f.titleAdd;if(l){n=f.titleEdit;j=l.data("action");if(!j){j=l.attr("href")}o=b.parseJSON(l.attr("data-raw"))}e(f.dialog,n,j,o)};b.fn.rapidForm.openCustom=function(k,l,j){a=null;e(k,l,j)};b(f.helpBlock+":visible").parents(f.formGroup).addClass(f.formGroupClass);return h}})(jQuery);